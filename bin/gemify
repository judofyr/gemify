#!/usr/bin/env ruby

$:.unshift File.dirname(__FILE__)+"/../lib"

require 'gemify'
require 'optparse'

options = {}
options[:interactive] = true # Interactive by default

parser = OptionParser.new do |opts|
  opts.banner = "Usage: #{opts.program_name} [options]"
  opts.separator ""
  opts.separator "Options:"
  opts.on("-h", "--help",  "Shows this message") do |val|
    $stdout.puts opts
    exit(0)
  end
  opts.on("-I", "--no-interactive", "Automaticically builds the gem") do |val|
    options[:interactive] = false
  end
  opts.on("-c", "--from-vcs", "Use files from version control system" ) do |val|
    options[:vcs] = true
  end
end

begin
  parser.parse!(ARGV)
rescue => e
  $stderr.puts "Error: #{e.message}"
  $stdout.puts parser
  exit -1
end

begin
  gemify = Gemify.new
  gemify.from_vcs = !!options[:vcs]
  if not options[:interactive] and File.exist?(Gemify::SETTINGS)
    gemify.build!
  else
    gemify.main
  end
rescue Gemify::Exit
  exit
end
